<html STYLE="width: 364px; height: 320px; ">
<head><title>Insert Table</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1255">
<head>
<style>
  html, body, button, div, input, select, td, fieldset { font-family: MS Shell Dlg; font-size: 8pt; };
</style>
<script>

// if we pass the "window" object as a argument and then set opener to
// equal that we can refer to dialogWindows and popupWindows the same way
opener = window.dialogArguments;

var editdoc = window.dialogArguments;
var objTableLoaded = false;

function _CloseOnEsc() {
  if (event.keyCode == 27) { window.close(); return; }
}

window.onerror = HandleError

function HandleError(message, url, line) {
  var str = "An error has occurred in this dialog." + "\n\n"
  + "Error: " + line + "\n" + message;
  alert(str);
//  window.close();
  return true;
}

function Init() {

  var elmSelectedTable;
  var htmlSelectionControl = "Control";
  var grngMaster = editdoc.selection.createRange();
  
  document.body.onkeypress = _CloseOnEsc;
  
  if (editdoc.selection.type == htmlSelectionControl) {
    if (grngMaster.length == 1) {
      elmSelectedTable = grngMaster.item(0);
      if (elmSelectedTable.tagName == "TABLE") {
		objTableLoaded = true;
		var strwidth = '';
		var strext = '';
		var ind = elmSelectedTable.width.indexOf("%") ;
		if(ind > 0)
		{ 
			strwidth = elmSelectedTable.width.substring(0,ind);
			strext = '%';
		}else{
			strwidth = elmSelectedTable.width;
		}
        document.all.border.value		= elmSelectedTable.border;
        document.all.cellspacing.value  = elmSelectedTable.cellSpacing;
        document.all.cellpadding.value  = elmSelectedTable.cellPadding;
        document.all.alignment.value	= elmSelectedTable.align;
        document.all.borderColor.value	= elmSelectedTable.borderColor;
        document.all.imgborderColor.style.backgroundColor = elmSelectedTable.borderColor ;
        document.all.bgrColor.value		= elmSelectedTable.bgColor;
        document.all.imgbgrColor.style.backgroundColor = elmSelectedTable.bgColor ;
        document.all.txtFileName.value	= elmSelectedTable.background.replace(/^[^*]*(\*\*\*)/, "$1");
        document.all.theight.value		= elmSelectedTable.height;
        document.all.width.value		= strwidth ;
        document.all.widthExt.value		= strext ;
        document.all.rows.value			= elmSelectedTable.rows.length ;
        rows.disabled			 		= true;
        document.all.cols.value			= parseInt(elmSelectedTable.cells.length / elmSelectedTable.rows.length ) ;
        cols.disabled					= true;
      }
    }
  }
  btnOK.onclick = new Function("UploadImage()");
  document.all.txtFileName.value = document.all.txtFileName.value || 'http://';
}

function _isValidNumber(txtBox) {
  var val = parseInt(txtBox);
  if (isNaN(val) || val < 0 || val > 9999) { return false; }
  return true;
}
function UploadImage() {
	if(document.form1.UploadFile1.value=='') 
	{ 
		btnOKClick(); 
	}else{
		document.form1.submit();
	}	
}
function btnOKClick() {
  var elmSelectedTable ;
  var bgrimage = '';
  var curRange = editdoc.selection.createRange();
	// error checking
  var checkList = ['rows','cols','border','cellspacing','cellpadding'];
  for (var idx in checkList) {
    var fieldname = checkList[idx];
    if (document.all[fieldname].value == "") {
      alert("You must specify a value for the '" +fieldname+ "' field!");
      document.all[fieldname].focus();
      return;
    }
    else if (!_isValidNumber(document.all[fieldname].value)) {
      alert("You must specify a number between 0 and 9999 for '" +fieldname+ "'!");
      document.all[fieldname].focus();
      return;
    }
  }

  if (editdoc.selection.type == "Control" || curRange.htmlText) {
    if (curRange.length == 1) {
      elmSelectedTable = curRange.item(0);
      if (elmSelectedTable.tagName == "TABLE") {
		if (document.all.txtFileName.value && document.all.txtFileName.value != "http://") {
			bgrimage = document.all.txtFileName.value;
		}
        elmSelectedTable.border = document.all.border.value;
        elmSelectedTable.cellSpacing = document.all.cellspacing.value;
        elmSelectedTable.cellPadding = document.all.cellpadding.value;
        elmSelectedTable.borderColor = document.all.borderColor.value;
        elmSelectedTable.bgColor = document.all.bgrColor.value;
        elmSelectedTable.background = bgrimage;
        elmSelectedTable.background = elmSelectedTable.background.replace(/^[^*]*(\*\*\*)/, "$1"); // fix placeholder src values that editor converted to abs paths
        elmSelectedTable.align = document.all.alignment.value;
        elmSelectedTable.width = document.all.width.value + document.all.widthExt.value ;
        elmSelectedTable.height = document.all.theight.value ;
        elmSelectedTable.removeAttribute("style");
      }
    }
  }
  
  if( ! objTableLoaded ) 
  {
	// delete selected content (if applicable)
	if (editdoc.selection.type == "Control" || curRange.htmlText) {

		if (!confirm("Overwrite selected content?")) { return; }

		curRange.execCommand('Delete');
		curRange = editdoc.selection.createRange();
	}
	if (document.all.txtFileName.value && document.all.txtFileName.value != "http://") {
		bgrimage = document.all.txtFileName.value;
		bgrimage = bgrimage.replace(/^[^*]*(\*\*\*)/, "$1"); // fix placeholder src values that editor converted to abs paths
    }
	// create table
	var table = '<table border="' +document.all.border.value+ '"'
	          + ' cellspacing="' +document.all.cellspacing.value+ '"'
	          + ' cellpadding="' +document.all.cellpadding.value+ '"'
			  + ' bgcolor="' +document.all.bgrColor.value+ '"'
			  + ' background="' +bgrimage+ '"'
			  + ' bordercolor="' +document.all.borderColor.value+ '"'
	          + ' width="' +document.all.width.value + document.all.widthExt.value+ '"'
	          + ' height="' +document.all.theight.value+ '"'
	          + ' align="' +document.all.alignment.value+ '">\n';

	for (var x=0; x<document.all.rows.value; x++) {
	  table += " <tr>\n";
	  for (var y=0; y<document.all.cols.value; y++) {
	    table += "  <td valign=top width="+ parseInt(100/document.all.cols.value) +"%></td>\n";
	  }
	  table += " </tr>\n";
	}
	table += "</table>\n";

	// insert table
	//opener.editor_insertHTML(objname, table); 
	curRange.pasteHTML(table)
  }  
  // close popup window
  
  window.close();
}
function setBgrColor()
{
	var oldcolor = document.all.bgrColor.value;
    var newcolor = showModalDialog("select_color.html", oldcolor, "resizable: no; help: no; status: no; scroll: no;");
    if (newcolor != null) { document.all.bgrColor.value = "#"+newcolor; document.all.imgbgrColor.style.backgroundColor = "#"+newcolor;}
}
function setBorderColor()
{
	var oldcolor = document.all.borderColor.value;
    var newcolor = showModalDialog("select_color.html", oldcolor, "resizable: no; help: no; status: no; scroll: no;");
    if (newcolor != null) { document.all.borderColor.value = "#"+newcolor; document.all.imgborderColor.style.backgroundColor = "#"+newcolor;}
}

</SCRIPT>
</HEAD>
<BODY id=bdy onload="Init()" style="background: threedface; color: windowtext; margin: 10px; BORDER-STYLE: none" scroll=no>

<table id=tbl1 border=0 cellspacing=0 cellpadding=1 style="margin: 0 0 8 0">
 <tr>
	<td>Rows: &nbsp;</td>
	<td><input type="text" name="rows" id="rows" value="4"  style="width: 50px" maxlength=4></td>
	<td width=10>&nbsp;</td>
	<td>Height: &nbsp;</td>
	<td>
	 <input type="text" name="theight" value="" style="width: 50px" maxlength=4>
	 pixels
	</td>
 </tr>
 <tr>
	<td>Cols:</td>
	<td><input type="text" name="cols" id="cols" value="3"  style="width: 50px" maxlength=4></td>
	<td width=10>&nbsp;</td>
	<td>Width: &nbsp;</td>
	<td>
	 <input type="text" name="width" value="100" style="width: 50px" maxlength=4>
	 <select name="widthExt" id="widthExt">
	  <option value="">Pixels</option>
	  <option value="%" selected>Percent</option>
	 </select>
	</td>
 </tr>
</table>

<FIELDSET style="width: 334px; text-align: center;left: 12px; top: 60px; position: absolute">
<LEGEND>Background</LEGEND>
<table border=0 cellspacing=6 cellpadding=0>
 <tr>
	<td width=76>Color:</td>
	<td>
		<input type="text" name="bgrColor" value="" size=7 readonly style="width: 214px; height: 22px;">&nbsp;<BUTTON style="width: 22px; height: 22px; border: 1px none;"  unselectable="on" onclick="setBgrColor();" id=button4 name=button4><img id=imgbgrColor style="background-color:#000000;" src="../images/selcolor.gif" border=0></BUTTON> 
	</td> 
 </tr>
 <tr>
	<td nowrap>Upload image:&nbsp;</td>
	<td>
		<form name="form1" ACTION="Aimgadd.asp?ins=table" target="hidden_frame" METHOD="post" ENCTYPE="multipart/form-data">
		<input TYPE="FILE" NAME="UploadFile1" ID="UploadFile1" style="width: 240px; height: 22px;">
	</td> 
 </tr>
 </form>
 <tr>
	<td>Image URL:</td>
	<td>
		<input type="text" ID=txtFileName value="" style="width: 240px;" onfocus="select()"> 
	</td> 
 </tr>
</table>
</FIELDSET>

<FIELDSET style="width: 160px; text-align: left;left: 12px; top: 179px; position: absolute">
<LEGEND>Layout</LEGEND>

<table border=0 cellspacing=7 cellpadding=0 width=100%>
 <tr>
  <td width=73>Alignment:&nbsp;</td>
  <td>
   <select name="alignment" id="alignment" size=1 style="width: 100%">
   <option value="">Not set</option>
   <option value="left">Left</option>
   <option value="right">Right</option>
   <option value="center">Center</option>
   </select>
  </td>
 </tr>
 <tr>
  <td><nobr>Cell Spacing:</nobr></td>
  <td align=right><input type="text" name="cellspacing" value="0" style="width: 50px" maxlength=4></td>
 </tr>
 <tr>
  <td><nobr>Cell Padding:</nobr></td>
  <td align=right><input type="text" name="cellpadding" value="2" style="width: 50px" maxlength=4></td>
 </tr>
</table>
</FIELDSET>


<FIELDSET style="width: 160px; text-align: left;left: 186px; top: 179px; position: absolute">
<LEGEND>Borders</LEGEND>

<table id=tblb border=0 cellspacing=6 cellpadding=0>
 <tr id=tr1>
  <td><nobr>Size:</nobr></td>
  <td><input type="text" name="border" value="1" size=3> pixels</td>
 </tr>
 <tr>
  <td><nobr>Color:</nobr></td>
  <td><input type="text" name="borderColor" value="" size=7 readonly style="height: 22px;">&nbsp;<BUTTON style="width: 22px; height: 22px; border: 1px none;"  unselectable="on" onclick="setBorderColor();" id=button3 name=button3><img id=imgborderColor style="background-color:#000000;" src="../images/selcolor.gif" border=0></BUTTON></td>
 </tr>
</table>
</FIELDSET>


<BUTTON ID=btnOK style="left: 198px; top: 264px; position: absolute; width: 70px; height: 22px;" type=submit>OK</BUTTON>
<BUTTON style="left: 275px; top: 264px; position: absolute; width: 70px; height: 22px;" type=reset onClick="window.close();">Cancel</BUTTON>

</BODY>
</HTML>